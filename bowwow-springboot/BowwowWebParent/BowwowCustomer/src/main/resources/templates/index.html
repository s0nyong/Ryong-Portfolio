<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
 xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
 
<head th:replace="fragments :: page_head('Home - Bowwow')">

</head>	
<body>

	<div th:replace="navigation :: menu"></div>
	
	<div>
		<div id="demo" class="carousel slide" data-ride="carousel">

			<ul class="carousel-indicators">
				<li data-target="#demo" data-slide-to="0" class="active"></li>
				<li data-target="#demo" data-slide-to="1"></li>
			</ul>

			<div class="carousel-inner">
				<div class="carousel-item active">
					<img th:src="@{/images/banner2.png}" alt="Los Angeles" style="width: 100%;">
				</div>
				<div class="carousel-item">
					<img th:src="@{/images/banner3.png}" alt="Chicago" style="width: 100%;">
				</div>
			</div>

			<a class="carousel-control-prev" href="#demo" data-slide="prev">
				<span class="carousel-control-prev-icon"></span>
			</a>
			<a class="carousel-control-next" href="#demo" data-slide="next">
				<span class="carousel-control-next-icon"></span>
			</a>
		</div>
	</div>
	
	<div class="container justify-content-center">
		
		<div>
			<br><h4 class="product-info">핫딜</h4><hr>
			<div class="row">
				<th:block th:each="pro:${hotdealproduct}">
					<div class="col-md-4 margin">
						<div class="card">
							<div class="ribbon-wrapper">
								<div class="ribbon red">HOT</div>
							</div>
							<a th:href="@{'/product/detail/' + ${pro.id} + '/1'}">
								<img th:src="@{${pro.mainImagePath}}" style="width:100%" class="card-img-top" />
							</a>
							<div class="card-body">
								<h5 class="card-title">[[${pro.mainName}]] [[${pro.subName}]] </h5>
								<div class="card-content">
									<div class="card-text">[[${pro.categoryId}]]
										<p><i class="fa-solid fa-star" style="color: #ffd70f; "></i>[[${new java.text.DecimalFormat("0.0").format(pro.score)}]]점</p>
									</div>
									<div class="card-bottom">
										<div>
											<h3 class="card-title text-danger">[[${pro.price}]]원</h3>									
										</div>
										<div sec:authorize="isAuthenticated()">
											<p th:each="userlikes:${userLikes}" th:id="|like${pro.id}|" th:if="${userlikes == pro.id}"
												class="fa-solid fa-heart icon-red float-right" th:onclick="|dislike(${pro.id})|" style="font-size: 20px;"></p>
											<p th:each="userUnLikes:${userUnLikes}" th:id="|like${pro.id}|" th:if="${userUnLikes == pro.id}"
												class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
										<div sec:authorize="isAnonymous()">
											<p class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
									</div>			
								</div>						
							</div>
						</div>
					</div>
				</th:block>
			</div>
		</div>
		
		<div>						
			<br><h4 class="product-info">베스트</h4><hr>
			<div class="row">
				<th:block th:each="pro:${bestproduct}">
					<div class="col-md-4 margin">
						<div class="card">
							<div class="ribbon-wrapper">
								<div class="ribbon blue">BEST</div>
							</div>
							<a th:href="@{'/product/detail/' + ${pro.id} + '/1'}">
								<img th:src="@{${pro.mainImagePath}}" style="width:100%" class="card-img-top" />
							</a>
							<div class="card-body">
								<h5 class="card-title">[[${pro.mainName}]] [[${pro.subName}]] </h5>
								<div class="card-content">
									<div class="card-text">[[${pro.categoryId}]]
										<p><i class="fa-solid fa-star" style="color: #ffd70f; "></i>[[${new java.text.DecimalFormat("0.0").format(pro.score)}]]점</p>
									</div>
									<div class="card-bottom">
										<div>
											<h3 class="card-title text-danger">[[${pro.price}]]원</h3>									
										</div>
										<div sec:authorize="isAuthenticated()">
											<p th:each="userlikes:${userLikes}" th:id="|like${pro.id}|" th:if="${userlikes == pro.id}"
												class="fa-solid fa-heart icon-red float-right" th:onclick="|dislike(${pro.id})|" style="font-size: 20px;"></p>
											<p th:each="userUnLikes:${userUnLikes}" th:id="|like${pro.id}|" th:if="${userUnLikes == pro.id}"
												class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
										<div sec:authorize="isAnonymous()">
											<p class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
									</div>			
								</div>						
							</div>
						</div>
					</div>
				</th:block>
			</div>
		</div>
	
		
		<div>
			<br>
			<h4 class="product-info">신상품</h4>
			<hr>
			<div class="row">
				<th:block th:each="pro:${recentproduct}">
					<div class="col-md-4 margin">
						<div class="card">
							<div class="ribbon-wrapper">
								<div class="ribbon green">NEW</div>
							</div>
							<a th:href="@{'/product/detail/' + ${pro.id} + '/1'}">
								<img th:src="@{${pro.mainImagePath}}" style="width:100%" class="card-img-top" />
							</a>
							<div class="card-body">
								<h5 class="card-title">[[${pro.mainName}]] [[${pro.subName}]] </h5>
								<div class="card-content">
									<div class="card-text">[[${pro.categoryId}]]
										<p><i class="fa-solid fa-star" style="color: #ffd70f; "></i>[[${new java.text.DecimalFormat("0.0").format(pro.score)}]]점</p>
									</div>
									<div class="card-bottom">
										<div>
											<h3 class="card-title text-danger">[[${pro.price}]]원</h3>									
										</div>
										<div sec:authorize="isAuthenticated()">
											<p th:each="userlikes:${userLikes}" th:id="|like${pro.id}|" th:if="${userlikes == pro.id}"
												class="fa-solid fa-heart icon-red float-right" th:onclick="|dislike(${pro.id})|" style="font-size: 20px;"></p>
											<p th:each="userUnLikes:${userUnLikes}" th:id="|like${pro.id}|" th:if="${userUnLikes == pro.id}"
												class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
										<div sec:authorize="isAnonymous()">
											<p class="fa-regular fa-heart icon-red float-right" th:onclick="|like(${pro.id})|" style="font-size: 20px;"></p>
										</div>
									</div>			
								</div>						
							</div>
						</div>
					</div>
				</th:block>
			</div>
		</div>
			
	</div>

	<div class="modal fade text-center" id="modalDialog2">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="modalTitle2">Warning</h4>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					
					<div class="modal-body">
						<span id="modalBody2"></span>
					</div>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-dismiss="modal">나중에</button>
						<button type="button" class="btn btn-danger" data-dismiss="modal" onclick="login()">확인</button>
					</div>
				</div>
			</div>
		  </div>

  	<div th:replace="fragments :: footer"></div>
<script>
	
	function login(){
			window.location = "[[@{/login}]]";
		}
		
	function like(id) {
			url = "[[@{/product/likeit/}]]";
			url+=id;
			console.log(url)
			csrfValue = $("input[name='_csrf']").val();
		
			params = {_csrf: csrfValue};
			btn = $(this);
			console.log(btn);
			$.post(url, params, function(response){
				if(response == "OK"){					
				if($('#like'+id).attr("class") == "fa-regular fa-heart icon-red float-right"){
					$('#like'+id).attr("class","fa-solid fa-heart icon-red float-right");
					$('#like'+id).attr("onclick","dislike("+id+")");
				}
			
				}else if(response == "NotUser"){
					showModalDialog2("ㅜㅜ","로그인 하시겠습니까?")
				}
			}).fail(function(){
				showModalDialog2("Error", "Could not connect to the server");
			});
			return false;
		}
		
		function dislike(id) {
			url = "[[@{/product/dislike/}]]";
			url+=id;
			console.log(url)
			csrfValue = $("input[name='_csrf']").val();
		
			params = {_csrf: csrfValue};
			btn = $(this);
			console.log(btn);
			$.post(url, params, function(response){
				if(response == "OK"){					
					if($('#like'+id).attr("class") == "fa-solid fa-heart icon-red float-right"){
						$('#like'+id).attr("onclick","like("+id+")");
						$('#like'+id).attr("class","fa-regular fa-heart icon-red float-right");
					}
				}else if(response == "NotUser"){
					showModalDialog2("ㅜㅜ","로그인 하시겠습니까?")
				}
			}).fail(function(){
				showModalDialog2("Error", "Could not connect to the server");
			});
			return false;
		}

		
	function showModalDialog2(title,message){
			$("#modalTitle2").text(title);
			$("#modalBody2").text(message);
			$("#modalDialog2").modal();
		}
	
	function showErrorModal(message){
				showModalDialog("Error!!",message);
			}
			
	
</script>
</body>      
</html>